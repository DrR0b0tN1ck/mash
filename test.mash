[[[save test.tex; exec pdflatex test; exec bibtex test; exec pdflatex test; keep test.pdf
  \documentclass[11pt]{article}
  \usepackage{graphicx}
  
  \begin{document}
    
    [[[save test.bib]]]

    Here's a graph.
    \begin{center}
    [[[save $1.dot; exec dot -Tpdf $1.dot -o $1.pdf; print \includegraphics{$1.pdf}
      graph {
        rankdir=LR
        d -- e
        d -- f
      }
    ]]]
    \end{center}

    Here's another graph.
    \begin{center}
    [[[save $1.dot; exec dot -Tpdf $1.dot -o $1.pdf; print \includegraphics{$1.pdf}
      graph { a -- b -- c}
    ]]]
    \end{center}

    More details are in some other document~\cite{abc}.
    [[[append test.bib
      @book{abc,
        author = {abc and def},
        title = {Title of a Book}
      }
    ]]]


    \bibliographystyle{plain}
    \bibliography{test}

  \end{document}

]]]
